<!DOCTYPE html>
<html>
<head>
  <title>Chronia Calendar</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<div id="container">
  <div id="sidebar">
    <h1>Chronia Calendar</h1>
    <div id="controls">
      <button id="prevMonth">&lt;</button>
      <div id="yearMonthDisplay">-- - --</div>
      <button id="nextMonth">&gt;</button>
    </div>
  </div>

  <div id="calendar-container">
    <div id="calendar"></div>
  </div>
</div>

<script>
  const weekdays = ['1', '2', '3', '4', '5', '6', '7'];

  let currentYear, currentMonth;

  function chronia(g) {
    const a = new Date(2016, 11, 22), d = Math.floor((g - a) / 864e5);
    let y = 0, r = d;
    while (r >= (y % 4 === 0 && (y % 100 !== 0 || y % 400 === 0) ? 366 : 365)) {
      r -= (y % 4 === 0 && (y % 100 !== 0 || y % 400 === 0) ? 366 : 365);
      y++;
    }
    if (r === 364) return `solstice day, year ${y}`;
    if (r === 365) return `leap day, year ${y}`;
    return `${(r % 28 + 1).toString().padStart(2, '0')}.${(Math.floor(r / 28) + 1).toString().padStart(2, '0')}.${y.toString().padStart(2, '0')}`;
  }

  function updateDisplay() {
    document.getElementById('yearMonthDisplay').textContent =
      `${currentMonth.toString().padStart(2, '0')} - ${currentYear.toString().padStart(2, '0')}`;
  }

function drawCalendar() {
  updateDisplay();

  const todayChronia = chronia(new Date());
  const [todayDay, todayMonth, todayYear] = todayChronia.includes('.') ? todayChronia.split('.') : [null, null, null];

  const rows = (currentMonth === 13) ? 5 : 4;
  let html = '<table><tbody>';

  let day = 1;
  for (let week = 0; week < rows; week++) {
    html += '<tr>';
    for (let d = 0; d < 7; d++) {
      if (currentMonth === 13 && week === 4 && d === 0) {
        html += `<td><div style="width:100%;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:bold;color:#ffeb3b;">S</div></td>`;
      } else if (currentMonth === 13 && week === 4) {
        html += '<td></td>';
      } else {
        const isToday = parseInt(todayDay) === day &&
                        parseInt(todayMonth) === currentMonth &&
                        parseInt(todayYear) === currentYear;

        const style = isToday
          ? 'background-color: #ffeb3b; color: black; font-weight: bold; border-radius: 50%; width: 40px; height: 40px; display: inline-block; line-height: 40px;'
          : '';

        html += `<td><div style="${style}">${day}</div></td>`;
        day++;
      }
    }
    html += '</tr>';
  }

  html += '</tbody></table>';

  document.getElementById('calendar').innerHTML = html;
}

  function changeMonth(delta) {
    const calendar = document.getElementById('calendar');
    calendar.style.opacity = 0;

    setTimeout(() => {
      currentMonth += delta;
      if (currentMonth > 13) {
        currentMonth = 1;
        currentYear++;
      } else if (currentMonth < 1) {
        currentMonth = 13;
        currentYear--;
        if (currentYear < 0) currentYear = 0;
      }

      drawCalendar();
      calendar.style.opacity = 1;
    }, 200);
  }

  window.onload = () => {
    const chroniaDate = chronia(new Date());
    if (!chroniaDate.includes('solstice') && !chroniaDate.includes('leap')) {
      const [day, month, year] = chroniaDate.split('.');
      currentYear = parseInt(year);
      currentMonth = parseInt(month);
    } else {
      currentYear = 0;
      currentMonth = 1;
    }
    drawCalendar();

    document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
    document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));
  };
</script>

</body>
</html>
